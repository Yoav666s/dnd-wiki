<nav class="nav__list">
  {% if page.sidebar.title %}<h3 class="nav__title" style="padding-left: 0;">{{ page.sidebar.title }}</h3>{% endif %}
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">{{ site.data.ui-text[site.locale].menu_label | default: "Toggle Menu" }}</label>
  <ul class="nav__items">
    {% for navname in include.nav %}
      {% assign navigation = site.data.navigation[navname] %}
      {% for nav in navigation %}
        <li>
          {% if nav.part %}
            {% assign rule_chapters = site.rules | where: "part", nav.part | sort: "chapter" %}
          {% elsif nav.class %}
            {% assign subclasses = site.classes | where: "subclass", nav.class | sort: "title" %}
          {% elsif navname == "feats" %}
            {% assign feats = site.feats | sort: "source" %}
          {% elsif nav.wip != nil %}
            {% assign adventures = site.adventures | where: "wip", nav.wip | sort: "title" %}
          {% elsif navname == "monsters" %}
            {% assign monsters = site.monsters | sort: "challenge_rating" %}
          {% elsif navname == "spells" %}
            {% assign level_spells = site.spells | where: "level", nav.title | sort: "title" %}
          {% endif %}

          {% if navname == "expansions" %}
            {% assign subclasses = site.classes | where: "source", nav.title %}
            {% assign races = site.races | where: "source", nav.title %}
            {% assign level_spells = site.spells | where: "source", nav.title %}
            {% assign feats = site.feats | where: "source", nav.title %}
            {% assign items = site.items | where: "source", nav.title %}
            {% assign monsters = site.monsters | where: "source", nav.title %}
            {% assign adventures = site.adventures | where: "source", nav.title %}

            {% if subclasses %}{% assign subclasses = subclasses | sort: "subclass" %}{% endif %}
            {% if races %}{% assign races = races | sort: "title" %}{% endif %}
            {% if level_spells %}{% assign level_spells = level_spells | sort: "title" %}{% endif %}
            {% if feats %}{% assign feats = feats | sort: "title" %}{% endif %}
            {% if items %}{% assign items = items | sort: "title" %}{% endif %}
            {% if monsters %}{% assign monsters = monsters | sort: "title" %}{% endif %}
            {% if adventures %}{% assign adventures = adventures | sort: "title" %}{% endif %}
          {% endif %}

          {% if nav.url %}
            <a href="{{ nav.url | relative_url }}"><span class="nav__sub-title">{{ nav.title }}</span></a>
          {% else %}
            <span class="nav__sub-title">{{ nav.title }}</span>
          {% endif %}

          {% if nav.children != null %}
          <ul>
            {% for child in nav.children %}
              <li><a href="{{ child.url | relative_url }}"{% if child.url == page.url %} class="active"{% endif %}>{{ child.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if subclasses %}
          <ul>
            {% for subclass in subclasses %}
              <li><a href="{{ subclass.url | relative_url }}"{% if subclass.url == page.url %} class="active"{% endif %}>{{ subclass.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if races %}
          <ul>
            {% for race in races %}
              <li><a href="{{ race.url | relative_url }}"{% if race.url == page.url %} class="active"{% endif %}>{{ race.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if level_spells %}
          <ul>
            {% for spell in level_spells %}
              <li><a href="{{ spell.url | relative_url }}"{% if spell.url == page.url %} class="active"{% endif %}>{{ spell.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if feats %}
          <ul>
            {% for feat in feats %}
              <li><a href="{{ feat.url | relative_url }}"{% if feat.url == page.url %} class="active"{% endif %}>{{ feat.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if rule_chapters %}
          <ul>
            {% for chapter in rule_chapters %}
              <li><a href="{{ chapter.url | relative_url }}"{% if chapter.url == page.url %} class="active"{% endif %}>{{ chapter.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if items %}
          <ul>
            {% for item in items %}
              <li><a href="{{ item.url | relative_url }}"{% if item.url == page.url %} class="active"{% endif %}>{{ item.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if monsters %}
          <ul>
            {% for monster in monsters %}
              <li><a href="{{ monster.url | relative_url }}"{% if monster.url == page.url %} class="active"{% endif %}>{{ monster.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}

          {% if adventures %}
          <ul>
            {% for adventure in adventures %}
              <li><a href="{{ adventure.url | relative_url }}"{% if adventure.url == page.url %} class="active"{% endif %}>{{ adventure.title }}</a></li>
            {% endfor %}
          </ul>
          {% endif %}
        </li>
      {% endfor %}
    {% endfor %}
  </ul>
</nav>
