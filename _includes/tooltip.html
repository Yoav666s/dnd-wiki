{% capture tooltip_content %}
{% if include.title contains ':' %}
  {% assign collection = include.title | split: ":" | first %}
  {% assign title = include.title | split: ":" | last %}
{% else %}
  {% assign collection = page.permalink | split: "/" | slice: 1 %}
  {% assign title = include.title %}
{% endif %}
{% assign index = title | slugify %}
{% assign spell = site.spells | where: "index", index | first %}
{% assign tooltip = site.tooltips | where: "index", index | first %}
{% assign subpage = site[collection] | where: "index", index | first %}
{% if spell %}
<span class="tooltip">
  <a href="{{ spell.permalink }}" class="tooltip-link">
    {{ include.title }}
  </a>
  <span class="tooltip-content">
    <strong>{{ spell.level }}</strong> ({{ spell.school }})<br>
    <i>{{ spell.excerpt | markdownify | strip_html }}</i>
  </span>
</span>
{% elsif tooltip %}
<span class="tooltip">
  <a {% if tooltip.link %}href="{{ tooltip.link }}" {% endif %}class="tooltip-link">
    {{ include.title }}
  </a>
  {% if tooltip.content %}
    <span class="tooltip-content">
      {{ tooltip.content }}
    </span>
  {% endif %}
</span>
{% elsif subpage %}
  <span class="tooltip">
    <a href="{{ page.permalink | append: index | relative_url }}" class="tooltip-link">
      {{ include.title }}
    </a>
    {% if subpage %}
      <span class="tooltip-content">
        {{ subpage.excerpt }}
      </span>
    {% endif %}
  </span>
{% else %}
  <a href="#{{ index }}" >{{ include.title }}</a>
{% endif %}
{% endcapture %}{{ tooltip_content | strip_newlines | strip }}
